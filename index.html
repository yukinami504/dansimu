<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport">
  <title>ダンカグのシミュレータ</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="dictionary.js"></script>
  <script src="mtmdata.js"></script>
  <script src="mtmdata2.js"></script>
  <script src="getdata.js"></script>
  <script src="mainfunc.js"></script>
  <script src="somefunc.js"></script>
  <script src="teamdata.js"></script>
  
  <link rel="stylesheet" type="text/css" href="style.css">
  <div id="scores">
  </div>
  
</head>
<body>
  <header>
	<h2 class="headline">
      <span>ダンカグのシミュレータ(α版)</span>
    </h2>
	<!--<ul class="nav-list">
      <li class="nav-list-item">Home</li>
      <li class="nav-list-item">tag1</li>
      <li class="nav-list-item">tag2</li>
    </ul>-->
  </header>
  
  <form name="dataForm">
	<!--<button type="button" onclick="getMtmData()">getMtmData()</button>
	<button type="button" onclick="getHrnData()">getHrnData()</button>
	<button type="button" onclick="getOtherData()">getOtherData()</button>
	<button type="button" onclick="getScoreData()">getScoreData()</button>-->
	<div class="open-window" id="releasenote" onclick="obj=document.getElementById('rel_nt').style; obj.display=(obj.display=='none')?'block':'none';">
	<a style="cursor:pointer;">▼ <span class="text-bold">お知らせ</span>（クリックで開閉）</a>
	</div>
	<div id="rel_nt" style="display:none;clear:both;">
	<p class="col-0">
	(2022.02.25) 楽曲を10曲実装しました。<br>
	(2022.02.23) チーム編成の入出力機能を追加しました。<br>
	(2022.02.23) 楽曲を3曲実装しました。<br>
	(2022.02.21) 楽曲を11曲実装しました。<br>
	(2022.02.18) 楽曲「絡繰りドール」「あうんどばいみー」を実装しました。<br>
	(2022.02.16) 新規ミタマカードと楽曲「レザマリでもつらくないっ！」を実装しました。<br>
	(2022.02.11) 新規ミタマカードと楽曲「神霊廟秋祭りっ！」を実装しました。<br>
	(2022.02.06) 新規ミタマカードと楽曲「ハルトマンの妖怪少女」を実装しました。<br>
	(2022.02.04) ハーフアニバーサリーおめでとうございます！<br>
	(2022.02.03) 新カグラエフェクトを実装しました。<br>
	(2022.01.10) ヒロインスキルを実装しました（要検証）。<br>
	(2022.01.04) ミタマカードのフィルタ・ソート機能を追加しました。<br>
	(2021.12.31) 開花ボーナスを8.0%まで拡張しました。
	</p>
	</div>
	<h3>曲選択</h3>
		<p>
			<select name="music" id="ms" required>
				<option value="0">楽曲を選択</option>
				<optgroup label="All" id="ms_all"></optgroup>
				<optgroup label="Em" id="ms_em"></optgroup>
				<optgroup label="Co" id="ms_co"></optgroup>
				<optgroup label="Ro" id="ms_ro"></optgroup>
				<!--<option value="fof">フォールオブフォール</option>-->
			</select>
			難易度 
			<select name="diff" id="diff" required>
				<option value="0">Easy</option>
				<option value="1">Normal</option>
				<option value="2">Hard</option>
				<option value="3">Extra</option>
				<option value="4" selected>Lunatic</option>
			</select>
		</p>
	<!--<h4>諸データ</h4>-->
		<!--<p>
			楽曲属性 <select name="music_attr" id="bn2">
				<option value="0">Em</option>
				<option value="1">Co</option>
				<option value="2">Ro</option>
				<option value="3" selected>All</option>
			</select>
		</p>-->
	<div class="open-window" onclick="obj=document.getElementById('team_io').style; obj.display=(obj.display=='none')?'block':'none';">
	<a style="cursor:pointer;">▼ チーム編成の入出力（クリックで開閉）</a>
	</div>
	<div class="open-window" id="team_io" style="display:none;clear:both;">
	<ul>
	<li>チーム編成出力</li>
	現在のチーム編成を文字列として出力できます<br>コピーしてメモ帳などに貼り付けて保管してください<br>
	<button type="button" class="btn-norm btn-b" onclick="outputTeam()">出力</button>
	<input type="text" id="tm_o" name="team-out" size="40">
	<!--<button type="button" class="btn-norm btn-b" onclick="copyTeam()">コピー</button>-->
	<li>チーム編成入力</li>
	文字列をこのページのチーム編成に反映させます<br>
	<input type="text" id="tm_i" name="team-in" size="40">
	<button type="button" class="btn-norm btn-b" onclick="inputTeam()">入力</button>
	</ul>
	</div>
	<h4>ヒロイン編成＆ボーナス</h4>
		<p>
			ヒロイン1: 
			<select name="hr1ch" id="chr1" required></select>
			Lv.<select name="hr1lv" id="lv1" required></select>
			Em補正 <select class="slc-list" name="hr1em" id="st1" required></select>
			Co補正 <select class="slc-list" name="hr1co" id="st2" required></select>
			Ro補正 <select class="slc-list" name="hr1ro" id="st3" required></select>
			Skill <select class="slc-list-b" name="hr1sk" id="sk1" required></select>
		</p>
		<p>
			ヒロイン2: 
			<select name="hr2ch" id="chr2" required></select>
			Lv.<select name="hr2lv" id="lv2" required></select>
			Em補正 <select class="slc-list" name="hr2em" id="st4" required></select>
			Co補正 <select class="slc-list" name="hr2co" id="st5" required></select>
			Ro補正 <select class="slc-list" name="hr2ro" id="st6" required></select>
			Skill <select class="slc-list-b" name="hr2sk" id="sk2" required></select>
		</p>
		<p>
			開花レベルボーナス: <select name="bloom" id="bn1" required></select>
		</p>
	<h4>チーム編成 </h4>
	<div class="open-window" onclick="obj=document.getElementById('fl_srt').style; obj.display=(obj.display=='none')?'block':'none';">
	<a style="cursor:pointer;">▼ ミタマカードのフィルタ・ソート設定（クリックで開閉）</a>
	</div>
	<div class="open-window" id="fl_srt" style="display:none;clear:both;">
	<ul><li>フィルタ設定</li>
		<span class="col-1">レアリティ</span>
		<span><label><input type="checkbox" name="fl_ssr" value="fl_ssr" checked>SSR</label></span>
		<span><label><input type="checkbox" name="fl_sr" value="fl_sr" checked>SR</label></span><br>
		
		<span class="col-1">属性</span>
		<span><label><input type="checkbox" name="fl_em" value="fl_em" checked>Em</label></span>
		<span><label><input type="checkbox" name="fl_co" value="fl_co" checked>Co</label></span>
		<span><label><input type="checkbox" name="fl_ro" value="fl_ro" checked>Ro</label></span><br>
	
		<span class="col-1">カグラエフェクト</span>
		<span><label><input type="checkbox" name="fl_score" value="fl_score" checked>スコアアップ</label></span>
		<span><label><input type="checkbox" name="fl_other" value="fl_other" checked>その他</label></span>
	
	<li>ソート設定</li>
	<span class="col-3">第一優先</span>
	<select name="sort1" id="sort1">
		<option value="0" selected>レアリティ</option>
		<option value="1">実装日</option>
		<option value="2">総戦力</option>
		<option value="3">Em属性値</option>
		<option value="4">Co属性値</option>
		<option value="5">Ro属性値</option>
		<option value="6">キャラクター</option>
	</select>
	<span class="col-3">第二優先</span>
	<select name="sort2" id="sort2">
		<option value="0">レアリティ</option>
		<option value="1" selected>実装日</option>
		<option value="2">総戦力</option>
		<option value="3">Em属性値</option>
		<option value="4">Co属性値</option>
		<option value="5">Ro属性値</option>
		<option value="6">キャラクター</option>
	</select></ul>
	<div><button type="button" class="btn-norm btn-b" onclick="mtmSort()">フィルタ・ソート設定を適用</button></div>
	</div>
	<div id="mtm">
    <p>
	  1人目:<select name="mitama1" id="m1" size="1" required><option value="0">御霊カードを選択</option></select>
	  レベル <select name="level1" id="l1" size="1"></select>
	  深化レベル <select name="sinka1" id="s1" size="1"></select><br>
	  2人目:<select name="mitama2" id="m2" size="1" required><option value="0">御霊カードを選択</option></select>
	  レベル <select name="level2" id="l2" size="1"></select>
	  深化レベル <select name="sinka2" id="s2" size="1"></select><br>
	  3人目:<select name="mitama3" id="m3" size="1" required><option value="0">御霊カードを選択</option></select>
	  レベル <select name="level3" id="l3" size="1"></select>
	  深化レベル <select name="sinka3" id="s3" size="1"></select><br>
	  4人目:<select name="mitama4" id="m4" size="1" required><option value="0">御霊カードを選択</option></select>
	  レベル <select name="level4" id="l4" size="1"></select>
	  深化レベル <select name="sinka4" id="s4" size="1"></select><br>
	  5人目:<select name="mitama5" id="m5" size="1" required><option value="0">御霊カードを選択</option></select>
	  レベル <select name="level5" id="l5" size="1"></select>
	  深化レベル <select name="sinka5" id="s5" size="1"></select><br>
	</p>
	</div>
	<button type="button" class="btn-big btn-a" onclick="calcForce(1)">戦力計算</button>
	<p>
	<table id="force_tbl">
		<tr> <td class="style-a">A1: ミタマ戦力</td> <td class="text-right">0</td> </tr>
		<tr> <td class="style-a">A2: 開花レベルボーナス</td> <td class="text-right">0</td> </tr>
		<tr> <td class="style-b">B: スキル効果予想値</td> <td class="text-right">0</td> </tr>
		<tr> <td class="style-c">C: 属性一致ボーナス</td> <td class="text-right">0</td> </tr>
		<tr> <td class="style-d">D: ヒロイン補正値</td> <td class="text-right">0</td> </tr>
		<tr> <th>総戦力</th> <td name="total_force" class="text-right">0</td> </tr>
	</table>
	</p>
	<h3>スコアシミュレーター</h3>
	<div id="score1">
		<p>
			総戦力 <input type="text" id="tb1" value="5000" maxlength="7"><br>
			<!--<input type="checkbox" id="cb1" name="mb_vis">ミタマバースト発動タイミングを表示<br>-->
			シミュレーション回数 <select name="simunum" id="sm1">
				<option value="1">1</option>
				<option value="10">10</option>
				<option value="100">100</option>
				<option value="1000" selected>1000</option>
				<option value="10000">10000</option>
			</select><br>
			ミタマバースト発動位置 <select name="mb_pos" id="sm2">
				<option value="0">なし</option>
				<option value="4">最適</option>
			</select>
			<button type="button"  class="btn-big btn-a" onclick="calcScore()">推定スコア算出</button>
		</p>
		<p id="text0" class="text-hidden">少女神楽中...</p>
		<p id="text1" class="text-hidden">ミタマバースト発動タイミング ： </p>
	</div>
	<div id="score2">
		<p id="text2_max"></p>
		<p id="text2_min"></p>
		<p id="text2_mean"></p>
	</div>
	<div id="stage"></div><!-- plotly.jsのキャンバス -->
  </form>
  <footer>
    <div class="container">
      <p>願わくは 花の下にて 春死なむ その如月の 望月のころ</p>
      <p>(c) 2021 yukinami</p>
    </div>
  </footer>
</body>
</html>

<script>

const input = document.getElementById('file');
let reader = new FileReader();

//window.addEventListener('load',getMtmData,false);
window.addEventListener('load',() => {
	console.log("b");
	concatMtmData();
	getMtmData();
	getHrnData();
	getOtherData();
	getMusicData();
});
/*
input.addEventListener('change', () => {
    alert('ファイルを読み込みました！');
	for(file of input.files) {
	  console.log(file);
	  //Fileオブジェクト（テキストファイル）のファイル内容を読み込む
	  reader.readAsText(file, 'UTF-8');
	  //ファイルの読み込み完了後に内容をコンソールに出力する
	  reader.onload = ()=> {
	    console.log(reader.result);
	  }
	}
	
});*/
/*
var clickEventType = (( window.ontouchstart!==null ) ? 'click':'touchend');//スマホか否か
ms_list.addEventListener(clickEventType, () => {
    //alert('event');
    console.log('event');
    console.log(ms_list.value);
	getScoreData(ms_list.value);
	
});*/

const ms_list = document.getElementById('ms');
ms_list.addEventListener('change', () => {
    //alert('event');
    console.log('event');
    console.log(ms_list.value);
	getScoreData(ms_list.value);
});

const hrnlv1_list = document.getElementById("lv1");
hrnlv1_list.addEventListener('change', () => {
    //alert('event');
    console.log('lv1');
    console.log(lv1.value);
	setHrnData(1,lv1.value);
});

const hrnlv2_list = document.getElementById("lv2");
hrnlv2_list.addEventListener('change', () => {
    //alert('event');
    console.log('lv2');
    console.log(lv2.value);
	setHrnData(2,lv2.value);
});
</script>